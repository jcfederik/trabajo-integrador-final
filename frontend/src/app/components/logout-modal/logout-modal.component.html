<div class="modal-backdrop fade show" style="z-index: 1055;"></div>
<div class="modal fade show d-block" style="z-index: 1060;" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    
    <!-- VISTA DE PERFIL -->
    <div *ngIf="!mostrarConfirmacion" class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-person-circle me-2"></i>
          Mi Perfil
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="cancelar()"></button>
      </div>
      
      <div class="modal-body">
        <!-- Información del usuario -->
        <div class="user-info mb-4">
          <div class="d-flex align-items-center mb-3">
            <div class="avatar bg-light text-primary rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 50px; height: 50px;">
              <i class="bi {{ getTipoUsuarioIcono(currentUser()?.tipo) }}"></i>
            </div>
            <div>
              <h6 class="mb-0 fw-bold">{{ currentUser()?.nombre || 'Usuario' }}</h6>
              <span class="badge bg-{{ getTipoUsuarioColor(currentUser()?.tipo) }} d-inline-flex align-items-center">
                <i class="bi {{ getTipoUsuarioIcono(currentUser()?.tipo) }} me-1"></i>
                {{ currentUser()?.tipo | titlecase }}
              </span>
            </div>
          </div>
        </div>

        <!-- Sección de especializaciones - SOLO PARA TÉCNICOS Y ADMINISTRADORES -->
        <div *ngIf="mostrarEspecializaciones()" class="especializaciones-section mb-4">
          <h6 class="fw-bold mb-3 text-primary">
            <i class="bi bi-mortarboard me-2"></i>
            Mis Especializaciones
          </h6>
          
          <!-- Si tiene especializaciones -->
          <div *ngIf="tieneEspecializaciones(); else sinEspecializaciones">
            <div class="d-flex flex-wrap gap-2 mb-3">
              <span *ngFor="let esp of currentUser()!.especializaciones" 
                    class="badge bg-success">
                {{ esp.nombre }}
              </span>
            </div>
            <small class="text-muted">
              Total: {{ currentUser()!.especializaciones.length }} especialización(es)
            </small>
          </div>

          <!-- Sin especializaciones (solo para técnicos/administradores) -->
          <ng-template #sinEspecializaciones>
            <div class="alert alert-warning py-2 mb-3">
              <small>
                <i class="bi bi-exclamation-triangle me-1"></i>
                <span *ngIf="esTecnico()">No tenés especializaciones asignadas</span>
                <span *ngIf="esAdministrador()">No tenés especializaciones asignadas como administrador</span>
              </small>
            </div>
          </ng-template>

          <!-- Botón para gestionar especializaciones - SOLO PARA ADMINISTRADORES -->
          <button *ngIf="esAdministrador()" 
                  class="btn btn-outline-danger btn-sm w-100 mt-2" 
                  (click)="irAEspecializaciones()"
                  title="Gestionar especializaciones de todos los técnicos">
            <i class="bi bi-gear me-1"></i>
            Gestionar especializaciones del sistema
          </button>

          <!-- Mensaje informativo para técnicos -->
          <div *ngIf="esTecnico() && !tieneEspecializaciones()" class="alert alert-info mt-2">
            <small>
              <i class="bi bi-info-circle me-1"></i>
              Contactá a un administrador para asignarte especializaciones
            </small>
          </div>
        </div>

        <!-- Información adicional del usuario -->
        <div class="user-details mt-4 pt-3 border-top">
          <h6 class="fw-bold mb-3 text-primary">
            <i class="bi bi-info-circle me-2"></i>
            Información de contacto
          </h6>
          <div class="row small">
            <div class="col-12 mb-2" *ngIf="currentUser()?.email">
              <i class="bi bi-envelope me-2 text-muted"></i>
              <span class="text-muted">Email:</span>
              <span class="ms-2">{{ currentUser()?.email }}</span>
            </div>
            <div class="col-12" *ngIf="currentUser()?.telefono">
              <i class="bi bi-telephone me-2 text-muted"></i>
              <span class="text-muted">Teléfono:</span>
              <span class="ms-2">{{ currentUser()?.telefono }}</span>
            </div>
          </div>
        </div>

        <!-- Sección de permisos (solo para administradores) -->
        <div *ngIf="esAdministrador()" class="admin-info mt-4 pt-3 border-top">
          <h6 class="fw-bold mb-3 text-danger">
            <i class="bi bi-shield-check me-2"></i>
            Privilegios de administrador
          </h6>
          <div class="alert alert-danger py-2">
            <small>
              <i class="bi bi-exclamation-triangle me-1"></i>
              Tenés acceso completo al sistema incluyendo gestión de usuarios, especializaciones y configuración
            </small>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelar()">
          <i class="bi bi-x-circle me-1"></i>
          Cerrar
        </button>
        <button type="button" class="btn btn-warning" (click)="mostrarLogout()">
          <i class="bi bi-box-arrow-right me-1"></i>
          Cerrar Sesión
        </button>
      </div>
    </div>

    <!-- VISTA DE CONFIRMACIÓN DE LOGOUT -->
    <div *ngIf="mostrarConfirmacion" class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">
          <i class="bi bi-box-arrow-right me-2"></i>
          Cerrar Sesión
        </h5>
        <button type="button" class="btn-close" (click)="volverAlPerfil()"></button>
      </div>
      
      <div class="modal-body text-center py-4">
        <div class="logout-icon mb-3">
          <i class="bi bi-question-circle text-warning" style="font-size: 3rem;"></i>
        </div>
        <h5 class="mb-3">¿Estás seguro de que querés cerrar sesión?</h5>
        
        <p class="text-muted mb-0">
          <span *ngIf="esAdministrador()">
            <i class="bi bi-exclamation-triangle text-danger me-1"></i>
            Como administrador, otros usuarios no podrán realizar ciertas operaciones hasta que vuelvas a iniciar sesión.
          </span>
          <span *ngIf="!esAdministrador()">
            Serás redirigido al login y deberás ingresar nuevamente.
          </span>
        </p>
      </div>
      
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-outline-secondary me-3" (click)="volverAlPerfil()">
          <i class="bi bi-arrow-left me-1"></i>
          Volver al Perfil
        </button>
        <button type="button" class="btn btn-warning" (click)="confirmarLogout()">
          <i class="bi bi-box-arrow-right me-1"></i>
          Sí, Cerrar Sesión
        </button>
      </div>
    </div>

  </div>
</div>