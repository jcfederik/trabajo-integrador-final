<div class="container-fluid py-4">
  <div class="usuarios-container">
    <!-- Header -->
    <div class="usuarios-header">
      <h1 class="usuarios-title">Gestión de Usuarios</h1>

      <div class="usuarios-actions">
        <button class="action-pill" (click)="mostrarFormulario = !mostrarFormulario">
          <i class="bi bi-plus-circle"></i>
          {{ mostrarFormulario ? 'Cancelar' : 'Nuevo Usuario' }}
        </button>
      </div>
    </div>


    <!-- Formulario de creación -->
    <div class="crear-usuario-card" *ngIf="mostrarFormulario">
      <div class="crear-usuario-header">
        <i class="bi bi-person-plus"></i>
        <h3 class="crear-usuario-title">Crear Nuevo Usuario</h3>
      </div>
      <div class="card-body">
        <form (ngSubmit)="crearUsuario()">
          <div class="row">
            <div class="col-md-4 form-group-enhanced">
              <label class="form-label-enhanced">Nombre de Usuario</label>
              <input type="text" class="form-control-enhanced" 
                     [(ngModel)]="nuevoUsuario.nombre" name="nombre" 
                     placeholder="Ingresá el nombre" required>
            </div>
            <div class="col-md-4 form-group-enhanced">
              <label class="form-label-enhanced">Tipo de Usuario</label>
              <select class="form-control-enhanced" 
                      [(ngModel)]="nuevoUsuario.tipo" name="tipo" required>
                <option value="usuario">Secretario/Administrativo</option>
                <option value="tecnico">Técnico</option>
                <option value="administrador">Administrador</option>
              </select>
            </div>
            <div class="col-md-4 form-group-enhanced">
              <label class="form-label-enhanced">Contraseña</label>
              <input type="password" class="form-control-enhanced" 
                     [(ngModel)]="nuevoUsuario.password" name="password" 
                     placeholder="Ingresá la contraseña" required>
            </div>
          </div>
          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="action-pill success active">
              <i class="bi bi-check-circle"></i>
              Crear Usuario
            </button>
            <button type="button" class="action-pill" (click)="cancelarCreacion()">
              <i class="bi bi-x-circle"></i>
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Lista de usuarios -->
    <div class="usuarios-table-container">
      <div class="table-header">
        <h3 class="table-title">
          <i class="bi bi-people"></i>
          Lista de Usuarios
          <span class="badge bg-primary ms-2">{{ usuarios.length }}</span>
        </h3>
      </div>
      
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th width="80">ID</th>
              <th>Usuario</th>
              <th width="200">Tipo</th>
              <th width="200" class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuarios" class="user-row">
              
              <!-- Modo visualización normal -->
              <td class="fw-bold text-muted" *ngIf="editandoUsuario?.id !== usuario.id">#{{ usuario.id }}</td>
              <td *ngIf="editandoUsuario?.id !== usuario.id">
                <div class="d-flex align-items-center">
                  <i class="bi bi-person-circle me-3 text-primary" style="font-size: 1.5rem;"></i>
                  <div>
                    <strong class="d-block">{{ usuario.nombre }}</strong>
                    <small class="text-muted">Usuario del sistema</small>
                  </div>
                </div>
              </td>
              <td *ngIf="editandoUsuario?.id !== usuario.id">
                <span class="badge-tipo" [ngClass]="{
                  'badge-admin': usuario.tipo === 'administrador',
                  'badge-usuario': usuario.tipo === 'usuario',
                  'badge-tecnico': usuario.tipo === 'tecnico'
                }">
                  <i class="bi me-1" [class]="{
                    'bi-shield-check': usuario.tipo === 'administrador',
                    'bi-person-check': usuario.tipo === 'usuario',
                    'bi-tools': usuario.tipo === 'tecnico'
                  }"></i>
                  {{ usuario.tipo }}
                </span>
              </td>
              
              <!-- Modo edición -->
              <td colspan="3" *ngIf="editandoUsuario?.id === usuario.id">
                <div class="row g-3 align-items-center">
                  <div class="col-md-3">
                    <input type="text" class="form-control form-control-sm" 
                           [(ngModel)]="usuarioEditado.nombre" placeholder="Nombre">
                  </div>
                  <div class="col-md-3">
                    <select class="form-select form-select-sm" [(ngModel)]="usuarioEditado.tipo">
                      <option value="usuario">Secretario/Administrativo</option>
                      <option value="tecnico">Técnico</option>
                      <option value="administrador">Administrador</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <input type="password" class="form-control form-control-sm" 
                           [(ngModel)]="usuarioEditado.password" placeholder="Nueva contraseña (opcional)">
                  </div>
                  <div class="col-md-3">
                    <div class="btn-action-group">
                      <div class="btn-action-group">
                        <button class="btn-save" (click)="guardarEdicion()">
                          <i class="bi bi-check-circle"></i> Guardar
                        </button>
                        <button class="btn-cancel" (click)="cancelarEdicion()">
                          <i class="bi bi-x-circle"></i> Cancelar
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </td>

              <!-- Acciones (solo en modo visualización) -->
              <td class="text-center" *ngIf="editandoUsuario?.id !== usuario.id">
                <div class="btn-action-group">
                  <button class="btn-editar" 
                          title="Editar usuario"
                          (click)="iniciarEdicion(usuario)">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn-eliminar" 
                          (click)="eliminarUsuario(usuario.id, usuario.nombre ?? usuario.name ?? 'Usuario')"
                          [disabled]="usuario.tipo === 'administrador'"
                          [title]="usuario.tipo === 'administrador' ? 'No se puede eliminar administradores' : 'Eliminar usuario'">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Estado vacío -->
      <div class="empty-usuarios" *ngIf="usuarios.length === 0">
        <div class="empty-icon">
          <i class="bi bi-people"></i>
        </div>
        <h3 class="empty-title">No hay usuarios registrados</h3>
        <p class="empty-description">Comienza creando el primer usuario del sistema</p>
        <button class="action-pill" (click)="mostrarFormulario = true">
          <i class="bi bi-plus-circle"></i>
          Crear Primer Usuario
        </button>
      </div>
    </div>
  </div>
</div>