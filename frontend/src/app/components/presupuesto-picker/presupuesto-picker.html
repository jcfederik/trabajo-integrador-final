<!-- Modal simple sin jQuery/Bootstrap JS (solo *ngIf) -->
<div class="modal-backdrop" *ngIf="visible" (click)="close()"></div>
<div class="modal-sheet" *ngIf="visible" role="dialog" aria-modal="true">
  <div class="sheet-header d-flex align-items-center gap-2">
    <i class="bi bi-clipboard-check fs-5"></i>
    <strong>Seleccionar presupuesto</strong>
    <button class="btn btn-sm btn-outline-secondary ms-auto" (click)="close()" aria-label="Cerrar">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <div class="sheet-body">
    <div class="input-group mb-3">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input type="text" class="form-control" placeholder="Número o apellido (cliente/técnico/desc.)"
             [(ngModel)]="term" (input)="onInput()">
    </div>

    <!-- Lista -->
    <div class="list-group list-group-flush" style="max-height: 50vh; overflow: auto;">
      <!-- Skeleton primera carga -->
      <ng-container *ngIf="loading && items.length === 0">
        <div class="list-group-item">
          <div class="placeholder-glow">
            <span class="placeholder col-3 me-2"></span>
            <span class="placeholder col-2 me-2"></span>
            <span class="placeholder col-4"></span>
          </div>
          <div class="placeholder-glow mt-2">
            <span class="placeholder col-7"></span>
          </div>
        </div>
        <div class="list-group-item" *ngFor="let s of [1,2,3]">
          <div class="placeholder-glow">
            <span class="placeholder col-3 me-2"></span>
            <span class="placeholder col-2 me-2"></span>
            <span class="placeholder col-4"></span>
          </div>
          <div class="placeholder-glow mt-2">
            <span class="placeholder col-7"></span>
          </div>
        </div>
      </ng-container>

      <!-- Vacío -->
      <div class="text-center text-muted py-4" *ngIf="!loading && items.length === 0">
        <i class="bi bi-inbox me-1"></i> Sin resultados
      </div>

      <!-- Items -->
      <button type="button" class="list-group-item list-group-item-action"
              *ngFor="let it of items" (click)="usar(it)">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-semibold">#{{ it.presupuesto.id }} — ${{ it.presupuesto.monto_total ?? 0 | number:'1.2-2' }}</div>
            <div class="small text-muted">
              Reparación: #{{ it.presupuesto.reparacion_id }}
              · Fecha: {{ it.presupuesto.fecha | date:'yyyy-MM-dd' }}
              <ng-container *ngIf="it.reparacion">
                · Desc.: {{ it.reparacion.descripcion | slice:0:60 }}<span *ngIf="(it.reparacion.descripcion||'').length>60">…</span>
              </ng-container>
            </div>
          </div>
          <i class="bi bi-arrow-right-circle fs-5"></i>
        </div>
      </button>
    </div>

    <!-- Cargar más -->
    <div class="d-grid mt-3" *ngIf="!loading && !lastPage">
      <button class="btn btn-outline-primary" (click)="fetchPage()">
        <span *ngIf="!loadingMore"><i class="bi bi-plus-circle me-1"></i> Cargar más</span>
        <span *ngIf="loadingMore"><span class="spinner-border spinner-border-sm me-2"></span> Cargando…</span>
      </button>
    </div>
  </div>
</div>
